<div class="grid" [formGroup]="form">
  <!-- HEADER START -->
  <div class="import-container">
    <span class="import">
      <button mat-raised-button type="button" (click)="selectFile()">
        File
      </button>
      or URL
      <input class="url" type="text" formControlName="url" />
      <button mat-raised-button type="button" (click)="load()">Load</button>
    </span>
  </div>

  <div class="options-row-one options-row">
    <span>
      <label for="columnar">Columnar</label>
      <input id="columnar" type="checkbox" formControlName="columnar" />
    </span>

    <span>
      <label for="separator">Separator</label>
      <select id="separator" formControlName="separator">
        <option value=",">,</option>
        <option value=";">;</option>
        <option [innerText]="'<tab>'" value="'<tab>'"></option>
        <option [innerText]="'<space>'" value="'<space>'"></option>
      </select>
    </span>

    <span>
      <label for="decimal-separator">Decimal Separator</label>
      <select id="decimal-separator" formControlName="decSeparator">
        <option value=".">.</option>
        <option value=",">,</option>
      </select>
    </span>

    <span>
      <label for="escape">Escape</label>
      <select id="escape" formControlName="escape">
        <option value="\">\</option>
      </select>
    </span>

    <span>
      <label for="quote">Quote</label>
      <select id="quote" formControlName="quote">
        <option value="'">'</option>
        <option value='"'>"</option>
      </select>
    </span>

    <span>
      <label for="merge-delimeters">Merge Delimiters</label>
      <input
        id="merge-delimeters"
        type="checkbox"
        formControlName="mergeDelimiters"
      />
    </span>

    <span>
      <label for="missing-value">Missing Value</label>
      <select id="missing-value" formControlName="missingValue">
        <option value="NaN">NaN</option>
        <option value="0">0</option>
      </select>
    </span>
  </div>
  

  <div class="options-row-two options-row">
    <span>
      <label for="duplicate-key-action">Duplicate Key Action</label>
      <select id="duplicate-key-action" formControlName="duplicateKeyAction">
        <option value="throwException">throwException</option>
        <option value="sumProducts">sumProducts</option>
        <option value="min">min</option>
        <option value="max">max</option>
        <option value="av">av</option>
      </select>
    </span>

    <span>
      <label for="horizontal-dimension">Horizontal Dimension</label>
      <input
        id="horizontal-dimension"
        type="text"
        formControlName="horizontalDimName"
      />
    </span>
    <ng-container [formGroup]="horizontalDimension">
      <span>
        <label for="type">Type</label>
        <select id="type" formControlName="type">
          <option value="string">string</option>
          <option value="value">value</option>
          <option value="time">time</option>
        </select>
      </span>

      <span>
        <label for="format">Format</label>
        <input
          id="units"
          type="text"
          formControlName="units"
          [matAutocomplete]="auto"
          class="form-control autocomplete"
        />
        <mat-autocomplete [panelWidth]="'10rem'" #auto="matAutocomplete">
          <ng-container *ngIf="type.value === 'time'">
            <mat-option
              *ngFor="let tfs of timeFormatStrings"
              [value]="tfs.value"
            >
              {{ tfs.label }}
            </mat-option>
          </ng-container>
        </mat-autocomplete>
      </span>
    </ng-container>
  </div>
  <!-- HEADER END -->

  <!-- Table START -->
  <div id="import-csv-canvas-container" class="canvas-container">
    <table *ngIf="parsedLines.length">
      <tr>
        <th>Dimension</th>
        <td
          *ngFor="let col of csvCols; let i = index"
          class="checkbox-container"
        >
          <input
            *ngIf="selectedCol > i"
            type="checkbox"
            name="{{ i }}"
            id="{{ i }}"
            (change)="updatedCheckBoxValue($event, i)"
          />
        </td>
      </tr>

      <tr>
        <th>Type</th>
        <td *ngFor="let col of csvCols; let i = index">
          <ng-container *ngIf="selectedCol > i && checkboxes[i]">
            <select
              value="{{ spec?.dimensions[i]?.type }}"
              (change)="spec.dimensions[i].type = $event.target.value"
            >
              <option value="string">string</option>
              <option value="value">value</option>
              <option value="time">time</option>
            </select>
          </ng-container>
        </td>
      </tr>

      <tr>
        <th>Format</th>
        <td *ngFor="let col of csvCols; let i = index">
          <input
            *ngIf="selectedCol > i && checkboxes[i]"
            type="text"
            [matAutocomplete]="autocompleteFormat"
            class="form-control"
            (change)="spec.dimensions[i].units = $event.target.value"
          />
          <mat-autocomplete
            id="format_{{ i }}"
            [panelWidth]="'10rem'"
            #autocompleteFormat="matAutocomplete"
            (optionSelected)="spec.dimensions[i].units = $event.option.value"
          >
            <ng-container *ngIf="spec?.dimensions[i]?.type === 'time'">
              <mat-option
                *ngFor="let tfs of timeFormatStrings"
                [value]="tfs.value"
              >
                {{ tfs.label }}
              </mat-option>
            </ng-container>
          </mat-autocomplete>
        </td>
      </tr>

      <tr>
        <th>Name</th>
        <td *ngFor="let col of csvCols; let i = index">
          <input
            *ngIf="selectedCol > i && checkboxes[i]"
            type="text"
            [matAutocomplete]="autocompleteName"
            class="form-control"
            value="{{ initialDimensionNames[i] }}"
            (change)="spec.dimensionNames[i] = $event.target.value"
          />
          <mat-autocomplete
            id="name_{{ i }}"
            [panelWidth]="'10rem'"
            #autocompleteName="matAutocomplete"
            (optionSelected)="spec.dimensionNames[i] = $event.option.value"
          >
            <mat-option [value]="parsedLines[selectedHeader][i]"
              >{{ parsedLines[selectedHeader][i] }}
            </mat-option>
          </mat-autocomplete>
        </td>
      </tr>

      <tr *ngFor="let row of parsedLines; let rowIndex = index">
        <th class="header" (click)="selectHeader(rowIndex)">
          <ng-container *ngIf="rowIndex === selectedHeader"
            >Header</ng-container
          >
        </th>
        <td
          *ngFor="let rowElement of row; let colIndex = index"
          (click)="selectRowAndCol(rowIndex, colIndex)"
          [ngStyle]="{ color: getColorForCell(rowIndex, colIndex) }"
        >
          {{ rowElement }}
        </td>
      </tr>
    </table>
  </div>
  <!-- Table END -->

  <div class="form-buttons">
    <button mat-raised-button class="btn cancel-btn" (click)="closeWindow()">
      Cancel
    </button>

    <button
      mat-raised-button
      class="btn ok-btn submit"
      type="submit"
      (click)="handleSubmit()"
    >
      Import
    </button>
  </div>
</div>
